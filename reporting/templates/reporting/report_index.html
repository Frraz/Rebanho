{% extends 'base/base.html' %}

{% block title %}Relat√≥rios - Sistema de Gest√£o{% endblock %}

{% block content %}
<div class="space-y-8">
    
    <!-- Header -->
    <div>
        <h1 class="text-3xl font-bold text-gray-900">üìä Relat√≥rios Gerenciais</h1>
        <p class="mt-2 text-gray-600">Gere relat√≥rios detalhados de movimenta√ß√µes, estoque e an√°lise de dados</p>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Relat√≥rio por Fazenda -->
        <div class="bg-white shadow-sm rounded-xl border border-gray-200 hover:shadow-md transition-shadow">
            <div class="px-6 py-6">
                <!-- Cabe√ßalho do Card -->
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                            <span class="text-2xl">üè°</span>
                            Relat√≥rio por Fazenda
                        </h3>
                        <p class="text-sm text-gray-500 mt-1">
                            Vis√£o detalhada de uma fazenda espec√≠fica
                        </p>
                    </div>
                </div>
                
                <!-- Lista de Informa√ß√µes -->
                <div class="bg-blue-50 rounded-lg p-4 mb-5">
                    <p class="text-sm font-medium text-blue-900 mb-2">üìã O relat√≥rio inclui:</p>
                    <ul class="text-xs text-blue-800 space-y-1 ml-4">
                        <li>‚Ä¢ Estoque inicial do per√≠odo</li>
                        <li>‚Ä¢ Todas as ocorr√™ncias (mortes, vendas, abates, doa√ß√µes)</li>
                        <li>‚Ä¢ Todas as movimenta√ß√µes (nascimentos, compras, manejos)</li>
                        <li>‚Ä¢ Estoque final calculado</li>
                        <li>‚Ä¢ Tabelas detalhadas por tipo de opera√ß√£o</li>
                    </ul>
                </div>
                
                <!-- Formul√°rio -->
                <form method="post" action="{% url 'reporting:farm' %}" class="space-y-4">
                    {% csrf_token %}
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Fazenda <span class="text-red-500">*</span>
                        </label>
                        <select name="farm" required 
                                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
                            <option value="">Selecione uma fazenda</option>
                            {% for farm in farms %}
                            <option value="{{ farm.id }}">{{ farm.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Data Inicial <span class="text-red-500">*</span>
                            </label>
                            <input type="date" name="start_date" required value="{{ default_start }}" 
                                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Data Final <span class="text-red-500">*</span>
                            </label>
                            <input type="date" name="end_date" required value="{{ default_end }}" 
                                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Filtrar por Categoria <span class="text-gray-400">(opcional)</span>
                        </label>
                        <select name="category" 
                                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm">
                            <option value="">üìä Todas as categorias</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">üêÑ {{ category.name }}</option>
                            {% endfor %}
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Deixe vazio para ver todas as categorias no relat√≥rio</p>
                    </div>
                    
                    <button type="submit" 
                            class="w-full flex items-center justify-center gap-2 px-4 py-2.5 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Gerar Relat√≥rio
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Relat√≥rio Consolidado (Fazendas Reunidas) -->
        <div class="bg-white shadow-sm rounded-xl border border-gray-200 hover:shadow-md transition-shadow">
            <div class="px-6 py-6">
                <!-- Cabe√ßalho do Card -->
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                            <span class="text-2xl">üìà</span>
                            Fazendas Reunidas
                        </h3>
                        <p class="text-sm text-gray-500 mt-1">
                            Consolida√ß√£o de m√∫ltiplas fazendas
                        </p>
                    </div>
                </div>
                
                <!-- Lista de Informa√ß√µes -->
                <div class="bg-purple-50 rounded-lg p-4 mb-5">
                    <p class="text-sm font-medium text-purple-900 mb-2">üìã O relat√≥rio inclui:</p>
                    <ul class="text-xs text-purple-800 space-y-1 ml-4">
                        <li>‚Ä¢ <strong>Vis√£o consolidada</strong> somando todas as fazendas</li>
                        <li>‚Ä¢ Estoque inicial e final totalizados</li>
                        <li>‚Ä¢ Todas as movimenta√ß√µes agregadas</li>
                        <li>‚Ä¢ <strong>Breakdown individual</strong> de cada fazenda</li>
                        <li>‚Ä¢ Comparativo entre propriedades</li>
                    </ul>
                </div>
                
                <!-- Formul√°rio -->
                <form method="post" action="{% url 'reporting:consolidated' %}" class="space-y-4">
                    {% csrf_token %}
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Selecionar Fazendas <span class="text-gray-400">(deixe vazio para todas)</span>
                        </label>
                        <div class="bg-gray-50 rounded-lg border border-gray-200 p-3">
                            <div class="space-y-2 max-h-44 overflow-y-auto">
                                <!-- Op√ß√£o "Selecionar Todas" -->
                                <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition-colors">
                                    <input type="checkbox" id="select-all-farms" 
                                           class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                           onclick="toggleAllFarms(this)">
                                    <span class="ml-2 text-sm font-semibold text-gray-900">‚ú® Selecionar Todas</span>
                                </label>
                                <hr class="my-2">
                                {% for farm in farms %}
                                <label class="flex items-center p-2 hover:bg-white rounded cursor-pointer transition-colors farm-checkbox">
                                    <input type="checkbox" name="farms" value="{{ farm.id }}" 
                                           class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 farm-item">
                                    <span class="ml-2 text-sm text-gray-700">üè° {{ farm.name }}</span>
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                        <p class="mt-2 text-xs text-gray-500">
                            üí° Se nenhuma fazenda for selecionada, o relat√≥rio incluir√° <strong>todas as fazendas</strong> automaticamente
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Data Inicial <span class="text-red-500">*</span>
                            </label>
                            <input type="date" name="start_date" required value="{{ default_start }}" 
                                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Data Final <span class="text-red-500">*</span>
                            </label>
                            <input type="date" name="end_date" required value="{{ default_end }}" 
                                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Filtrar por Categoria <span class="text-gray-400">(opcional)</span>
                        </label>
                        <select name="category" 
                                class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="">üìä Todas as categorias</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">üêÑ {{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <button type="submit" 
                            class="w-full flex items-center justify-center gap-2 px-4 py-2.5 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Gerar Relat√≥rio Consolidado
                    </button>
                </form>
            </div>
        </div>
        
    </div>
    
    <!-- Dica de Uso -->
    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl border-l-4 border-green-500 p-6">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <div class="ml-4">
                <h4 class="text-sm font-semibold text-gray-900">üí° Dicas para usar os relat√≥rios</h4>
                <div class="mt-2 text-sm text-gray-700 space-y-1">
                    <p>‚Ä¢ <strong>Relat√≥rio por Fazenda:</strong> Use para an√°lise detalhada de uma propriedade espec√≠fica</p>
                    <p>‚Ä¢ <strong>Fazendas Reunidas:</strong> Use para vis√£o geral do neg√≥cio e compara√ß√£o entre fazendas</p>
                    <p>‚Ä¢ <strong>Filtre por categoria:</strong> Para focar em um tipo espec√≠fico de animal (ex: apenas Bois)</p>
                    <p>‚Ä¢ <strong>Per√≠odo mensal:</strong> Recomendado para acompanhamento regular das movimenta√ß√µes</p>
                    <p>‚Ä¢ <strong>Impress√£o:</strong> Todos os relat√≥rios s√£o otimizados para impress√£o em formato paisagem</p>
                </div>
            </div>
        </div>
    </div>
    
</div>

<script>
// Fun√ß√£o para selecionar/desselecionar todas as fazendas
function toggleAllFarms(checkbox) {
    const farmCheckboxes = document.querySelectorAll('.farm-item');
    farmCheckboxes.forEach(cb => {
        cb.checked = checkbox.checked;
    });
}

// Atualizar o checkbox "Selecionar Todas" quando itens individuais mudarem
document.addEventListener('DOMContentLoaded', function() {
    const selectAllCheckbox = document.getElementById('select-all-farms');
    const farmCheckboxes = document.querySelectorAll('.farm-item');
    
    if (selectAllCheckbox && farmCheckboxes.length > 0) {
        farmCheckboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                const allChecked = Array.from(farmCheckboxes).every(checkbox => checkbox.checked);
                const noneChecked = Array.from(farmCheckboxes).every(checkbox => !checkbox.checked);
                
                selectAllCheckbox.checked = allChecked;
                selectAllCheckbox.indeterminate = !allChecked && !noneChecked;
            });
        });
    }
});
</script>

{% endblock %}